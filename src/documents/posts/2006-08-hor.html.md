---
layout: post
date: 2006-08
title: правильный горизонтальный список
---

С установкой IE7 совсем забыл о том, что у меня блок с архивами необлагорожен.
Точнее, облагорожен на скорую руку. Итак, попробую осветить процесс %) В общем, дизайнерская моя мысль была такова: если блок размером мал, то список там должен быть тоже малым, горизонтальным, да с запятой после каждого элемента. Просто перечисление
месяцев.

html-код, в общем-то, совершенно стандартен:

	<div id="archive">
		<h2>Archives:</h2>
		<ul>
			<li><a href="http://bitari.blogspot.com/2006_08_01_bitari_archive.html">Июль 2006</a></li>
			<li><a href="http://bitari.blogspot.com/2006_07_01_bitari_archive.html">Август 2006</a></li>
		</ul>
	</div>


Сделать же хотелось перечисление, да после каждой ссылки запятая чтобы стояла. Так как html-код генерируется автоматически блоггером, его изменить я не могу. Остаётся css. Для того, чтобы добавлять содержимое, в css2.1 есть свойство <var>content</var>, применяется он только в сочетании с псевдоклассами <var>:before</var> и <var>:after</var>, таким образом можно добавлять содержимое до и после какого-либо элемента. К сожалению, ни в IE6, ни даже в IE7 это свойство не поддерживается.

Для семейства IE эту проблему решит сооветствующий javascript, помещённый в условные комментарии.

Изначальный CSS:

	/* отключаю маркеры, выставляю высоту и требую все содержимое, что выходит за пределы высоты, прокручивать скроллбаром */
	#archive ul { height: 65px; width: 200px; list-style: none; overflow: auto }

И начинаю думать, как же быть с этими запятыми. Для начала, надо их поставить. Есть два
варианта - ставить запятую _после_ каждого list-item'а или _до_.

	/* до */
	#arhive li:before { content: ", " }
	/* или после */
	#archive li:after { content: ", " }

В любом случае придётся избавиться от одной запятой - если ставить _до_,
то окажется лишняя запятая перед первым элементом, если ставить _после_, будет лишней запятая после самого последнего элемента. Избавляемся:

вариант "до":

	#archive li:before { content: ", " }
	/* убираем запятую перед первым элементом */
	#archive li:first-child:before { display: none }

вариант "после":

	#archive li:after { content: ", " }
	/* убираем запятую после последнего элемента */
	#archive li:last-child:after { display: none }

Но! Как бы это не казалось странным, но псевдокласс <var>:first-child</var> <a href="http://www.w3.org/TR/CSS21/selector.html#first-child">описан</a> в спецификации css2.1, а <var>:last-child</var> <a href="http://www.w3.org/TR/css3-selectors/#last-child-pseudo">описан</a> в CSS3 Selectors... В общем, <var>:last-child</var> поддерживает только Firefox, его авторы посчитали логичным реализовывать <var>:first-child</var> и <var>:last-child</var> oдновременно, пусть они и прописаны в разных спецификациях. Авторы же Operа так не посчитали. Потому вариант с установкой запятой _после_ элемента отпадает -
за неимением <var>:last-child</var> мы не сумеем убрать запятую после последнего элемента. 

Выбрали.

Теперь возникает вопрос - а как же, собственно, укладывать наши list-item'ы в один ряд :) Для этого есть всего два варианта: сделать элементы списка поплавками или инлайн-элементами.

"поплавочное" решение:

	#archive ul { height: 65px; width: 200px; list-style: none; overflow: auto }
	#archive li { float: left; }
	#archive li:before { content: ", " }
	/* убираем запятую перед первым элементом */
	#archive li:first-child:before { display: none }

Этот вариант не подходит по той простой причине, что "всплывающие" элементы остаются
блоковыми, соответственно, если такой блок _не помещается_ в предоставленную родителем ширину, он "съезжает" вниз. А согласно спецификации ("_The formatting objects (e.g., boxes) generated by an element include generated content._"), наши сгенерированные запятые находятся <var>внутри</var> бокса элемента, соответственно если элемент этот "съедет", запятая уедет вместе с ним. Но это совершеннейшим образом некрасиво. В общем, при поддержке обоими браузерами <var>:last-child</var>, можно было бы использовать и поплавочный вариант.

Странно и непоследовательно то, что Opera9, не поддерживая css3-псевдокласс <var>:last-child</var>, использует модель генерируемого содержимого из css3.

<a href="http://www.w3.org/TR/REC-CSS2/generate.html#before-after-content">Cпецификация CSS2.1 говорит нам</a>:

> User agents must ignore the following properties with :before and :after pseudo-elements: 'position', 'float', list properties, and table properties.

<a href="http://www.w3.org/TR/2003/WD-css3-content-20030514/#pseudo-elements">Спецификация же CSS3 нам говорит</a>:

> display property ... Applies To: all elements, ::before, ::after, ::alternate, and ::outside

и

>For compatability with previous levels of CSS, the '::before', '::after', '::first-line' and '::first-letter' pseudo-elements do not require two colons. This does not apply to any other pseudo-element. Authors are encouraged to use the new two-colon forms.

В общем, Opera9 позволяет нам позиционировать генерированное содержимое как угодно.

Но раз мы решили не пользоваться поплавочным вариантом, пойдём и другим путём - сделаем все
list-item'ы инлайн-элементами:

	#archive ul { height: 65px; width: 200px; list-style: none; overflow: auto }
	#archive li { display: inline }
	#archive li:before { content: ", " }
	/* убираем запятую перед первым элементом */
	archive li:first-child:before { display: none }

Таким образом, получилась куча инлайн-элементов, фактически - длинная строка, содержимое которой браузер вполне может переносить. Значение <var>display</var> у сгенерированного содержимого также inline...

Но браузер переносит и по пробелам между месяцем и годом, но это уже совсем просто поправить - просто добавим <var>white-space: nowrap</var> для ссылок:

	#archive ul { height: 65px; width: 200px; list-style: none; overflow: auto }
	#archive li { display: inline }
	#archive li:before { content: ", " }
	/* убираем запятую перед первым элементом */
	#archive li:first-child:before { display: none }
	#archive a { white-space: nowrap }

Всё уже работает, только вот запятые отстоят от элементов, к которым должны "прилипать".
Объясняется этот отступ просто - перенос строки является пробельным символом :)

Чтобы его устранить, добавим отрицательный левый отступ для сгенерированного содержимого.

	#archive ul { height: 65px; width: 200px; list-style: none; overflow: auto }
	#archive li { display: inline }
	#archive li:before { content: ", "; margin-left: -.5ex }
	/* убираем запятую перед первым элементом */
	#archive li:first-child:before { display: none }
	#archive a { white-space: nowrap } 

Во многих шрифтах запятая по ширине примерно где-то в половину ширины малой буквы "x",
потому отступ я записал в <var>ex</var>. 

Всё, красота полнейшая. Напоследок покажу, как это будет выглядеть в блоге:

	#archive ul { height: 65px; width: 200px; list-style: none; overflow: auto }
	#archive li { display: inline }
	#archive li + li:before { content: ",\A0\A0"; margin-left: -.5ex; }

"<var>+</var>" - так называемый _direct adjacent combinator_, он специфицирует
заданные элементы, _следующие сразу за_ указанным элементом. Считайте, что про
<var>:first-child</var>/<var>:last-child</var> прочитали в общеобразовательных целях ;)

ну и js для IE. Его надо будет поместить в conditional comments, дабы чего не случилось.

	<!--[if lte IE 7]><script type="text/javascript">
		var addCommas = function(){
			var lis = document.all['archive'].lastChild.childNodes;
			var comma = document.createTextNode(', ');
			for(var i=0; i<lis.length-1; ++i)
				lis[i].insertBefore(comma.cloneNode(true), lis[i].lastChild);
		}
	</script><![endif]-->